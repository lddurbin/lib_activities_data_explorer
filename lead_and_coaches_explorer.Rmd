---
title: "`r paste0('Libraries Programmes and Events: ', params$lead_and_coach_area, ' Analysis (', params$month, ' ', params$year, ')')`"
author: "`r paste0('Lee Durbin', params$lead_and_coach)`"
date: "`r format(Sys.Date(), '%d %B %Y')`"
output:
  rmdformats::readthedown:
    highlight: kate
params:
  year: 2021
  month: July
  lead_and_coach_area: "Devonport-Takapuna, Kaipātiki"
  lead_and_coach_area_num: 2
  lead_and_coach: "Trina Roycroft"
  outcome_filename: "Devonport-Takapuna, Kaipātiki"
---


```{r setup, include=FALSE}
library(knitr)
library(rmdformats)
library(tidyverse)
library(scales)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=FALSE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)

common_table_headings <- c('Sessions', 'Participants (18+)', 'Participants (under 18)', 'Hours of Delivery')

source("data_prep.R")
```

## Overview

```{r overview}
# How many sessions were entered into the form?
monthly_submissions <- joined_data %>% 
  filter(month(as_date(delivery_datetime), label = TRUE, abbr = FALSE) == params$month & year(as_date(delivery_datetime)) == params$year) %>% 
  distinct(id) %>% 
  nrow()

# Of these, how many delivered against each Local Board?
local_board_submissions <- joined_data %>% 
  filter(!is.na(in_which_local_board_was_the_session_delivered) & month(as_date(delivery_datetime), label = TRUE, abbr = FALSE) == params$month & year(as_date(delivery_datetime)) == params$year) %>% 
  distinct(id) %>% 
  nrow()

# Filter down to an outcome area
outcome_data <- joined_data %>% 
  filter(month(as_date(delivery_datetime), label = TRUE, abbr = FALSE) == params$month & year(as_date(delivery_datetime)) == params$year & outcome == params$outcome)

# Stats for sessions that delivered against a given outcome area
this_outcome <- outcome_data %>% 
  distinct(id, outcome, .keep_all = TRUE) %>% 
  summarise_data(outcome)
```

In `r params$month` `r params$year`, **`r prettyNum(monthly_submissions, big.mark = ",")`** in-scope programmes, events, and Book a Librarian sessions were delivered across Tāmaki Makaurau. You can browse through the complete dataset by downloading the [Data Explorer](https://aklcouncil-my.sharepoint.com/:u:/g/personal/durbinl_aklc_govt_nz/ES56_6mDLOZIqrzoyLDpwU0B7R5rNPIhN2MYSSzAr_CYTA?download=1).

Of these `r prettyNum(monthly_submissions, big.mark = ",")` activities, a total of **`r prettyNum(outcome_submissions, big.mark = ",")`** were reported as having delivered against one of the six outcome areas. In other words, **`r round((outcome_submissions/monthly_submissions)*100)`%** of the in-scope libraries activities delivered in `r params$month` `r params$year` were reported as having delivered against at least one of the six outcomes.
